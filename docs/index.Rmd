---
title: "Supplementary material - S$: Policy sensitivity test"
author: "Simon Chiu"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())
gc()



library(progress)
library(tidyverse)
library(openxlsx)
library(ggplot2)
library(patchwork)
library(ggh4x)
library(ggpubr)
library(scales)
library(kableExtra)



# det_bmi_df_long<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/det_bmi_df_long_2023-07-16.RDS") %>% 
  # rename("bmi.output"="bmi", "age.groups.output"="age.groups", "gender.output"="gender")

# det_bmi_df_wide<-det_bmi_df_long %>% 
#   filter(scenario!="Base model") %>% 
#   rename('det.int.value'='value') %>% 
#   select("scenario" ,"run","bmi.output","age.groups.output","gender.output", "year", "det.int.value") %>% 
#   left_join(., det_bmi_df_long %>% 
#               filter(scenario=="Base model") %>% 
#               rename('det.base.model.value'='value') %>% 
#               select("bmi.output","age.groups.output","gender.output", "year", "det.base.model.value"),
#             by=c("bmi.output","age.groups.output","gender.output", "year")) %>% 
#   mutate(det.diff=det.int.value-det.base.model.value)

# derivative.lsa<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_2023-08-09.RDS")

derivative.lsa.epoch<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_epoch_2023-08-09.RDS")
derivative.lsa.cci<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_cci_2023-08-09.RDS")
derivative.lsa.si<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_si_2023-08-09.RDS")
derivative.lsa.svi<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_svi_2023-08-09.RDS")
derivative.lsa.ssb<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_ssb_2023-08-09.RDS")

derivative.lsa.epoch.int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_epoch_int_2023-08-16.RDS")
derivative.lsa.cci.int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_cci_int_2023-08-16.RDS")
derivative.lsa.si.int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_si_int_2023-08-16.RDS")
derivative.lsa.svi.int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_svi_int_2023-08-16.RDS")
derivative.lsa.ssb.int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_ssb_int_2023-08-16.RDS")

# lsa_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_bmi_df_2023-07-29.RDS")
# 
# plot.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/comparison_data_2023-07-28.RDS") %>%
# rename("BMI output"="bmi.output")

focus_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_2023-07-18.RDS")

list.of.focus.variables<-focus_df %>% 
arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
select(focus.title) %>% 
group_by(focus.title) %>% filter(row_number()==1)%>% data.frame()

list.of.focus.variables.levels<-focus_df %>% 
arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
select(focus) %>% 
group_by(focus) %>% filter(row_number()==1)%>% data.frame()

list.of.focus.variables.levels.plot.search<-focus_df %>% 
  arrange(focus.title, age.groups.input) %>% 
  group_by(focus) %>% filter(row_number()==1)%>% data.frame()



# df_summary<-
#   derivative.lsa.epoch %>% mutate(scenario="1 EPOCH") %>% 
#   add_case(derivative.lsa.cci %>% mutate(scenario="2 CCI")) %>%
#   add_case(derivative.lsa.si %>% mutate(scenario="3 SI")) %>%
#   add_case(derivative.lsa.svi %>% mutate(scenario="4 SVI")) %>%
#   add_case(derivative.lsa.ssb %>% mutate(scenario="5 SSB")) %>%
#   mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
#                                  scenario == "2 CCI"~2,
#                                  scenario == "3 SI"~3,
#                                  scenario == "4 SVI"~4,
#                                  scenario == "5 SSB"~5,
#                                  scenario == "6 EPOCH CCI"~6,
#                                  scenario == "7 SI SVI"~7,
#                                  scenario == "8 EPOCH CCI SI SVI"~8,
#                                  scenario == "9 EPOCH CCI SI SVI SSB"~9),
#                        levels=c(1:9),
#                        labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
#                                   "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
#   rename("Gender input"="gender.input", "Gender outcome"="gender.output", 
#          "Age input"="age.groups.input", "BMI outcome"="bmi.output",
#          "BMI input"="bmi.input")

lsa_basemodel_epoch_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_epoch_df_summary_2023-08-12.RDS")
lsa_basemodel_cci_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_cci_df_summary_2023-08-12.RDS")
lsa_basemodel_si_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_si_df_summary_2023-08-12.RDS")
lsa_basemodel_svi_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_svi_df_summary_2023-08-12.RDS")
lsa_basemodel_ssb_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_ssb_df_summary_2023-08-12.RDS")

df_summary<-
  lsa_basemodel_epoch_df_summary %>% 
  add_case(lsa_basemodel_cci_df_summary) %>% 
  add_case(lsa_basemodel_si_df_summary) %>% 
  add_case(lsa_basemodel_svi_df_summary) %>% 
  add_case(lsa_basemodel_ssb_df_summary) %>% 
  mutate(scenario=factor(case_when(scenario == "EPOCH"~1,
                                 scenario == "CCI"~2,
                                 scenario == "SI"~3,
                                 scenario == "SVI"~4,
                                 scenario == "SSB"~5,
                                 scenario == "EPOCH+CCI"~6,
                                 scenario == "SI+SVI"~7,
                                 scenario == "EPOCH+CCI+SI+SVI"~8,
                                 scenario == "EPOCH+CCI+SI+SVI+SSB"~9),
                       levels=c(1:9),
                       labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                  "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
  rename("Gender input"="gender.input", "Gender outcome"="gender.output", 
         "Age input"="age.groups.input", "BMI outcome"="bmi.output",
         "BMI input"="bmi.input")

combined.sugar.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/combined_sugar_int_df.RDS")

# epoch.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_epoch_df_2023-08-13.RDS")
# cci.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_cci_df_2023-08-13.RDS")
# si.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_si_df_2023-08-13.RDS")
# svi.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_svi_df_2023-08-13.RDS")
# ssb.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_ssb_df_2023-08-13.RDS")


lsa_int_epoch_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_epoch_df_summary_2023-08-15.RDS")
lsa_int_cci_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_cci_df_summary_2023-08-16.RDS")
lsa_int_si_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_si_df_summary_2023-08-16.RDS")
lsa_int_svi_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_svi_df_summary_2023-08-16.RDS")
lsa_int_ssb_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_ssb_df_summary_2023-08-16.RDS")



```


# Introduction
This document presents the results assessing the impact of input assumption on policy behaviour for the **D**c**i**sion **S**upport tool for **C**hild and **A**dolescence **O**besity, a system dynamic model developed to explore underlying relationships that contribute to youth obesity.

## Outline of behaviour sensitivity analysis

The test presented in this document aims to examine which input assumptions have the greatest impact on modelled policy behaviour, unlike previous sensitivity analyses, which focus on numerical relationships between input assumptions and the effectiveness of policy scenarios.

# Methods

A sensitivity analysis was conducted testing 649 input variables between $\pm$ 20% of an input's initial value. While each input value may have more extreme values, these input values are considered to be outside of probable values. The model generates 78 BMI prevalence outcomes for each sensitivity analysis, 3 BMI categories, 13 age groups and two genders. 

Model behaviour in policy effectiveness is defined as the trend, phase, lag or amplitude of a policy result over modelled time. Inputs that impact these outcome characteristics are considered to impact the model behaviour.

## Outcome Measure

The behaviour of each model test was evaluated using the cumulative difference of the first derivative. The following plots explain how this outcome measure is calculated.

Figure panel A shows a plot of three outcomes, the base model, where there are no changes to any initial assumptions. A result that varies an input assumption that produces similar policy behaviour, and a second test where varying the input assumption produces different policy behaviour. The absolute cumulative difference between the model outcomes is plotted in panel C. 

Panel B plots the first derivative of each policy result. The result with similar behaviour also has a similar first derivative. Conversely, the different behaviour result has a greater difference in the derivative. The cumulative absolute difference of the first derivative shows a greater difference between the two policy results highlighting the difference between behaviours.

While the cumulative absolute difference measure cannot give insights into the model structure, it is useful to screen input assumptions that impact policy <u> behaviour </u>.

Unlike the extreme test, this analysis focuses on determining which input assumption impacts the policy behaviour.


```{r example, echo=F, message=F, error=F, warning=F, fig.height=1*2*3.5, fig.width=1.6*2*3.5, fig.cap="Example plot for model behaviour"}
data.frame(x=seq(0,50, 0.5)) %>% 
  mutate(relapse=ifelse(x>=30,0.00003*(x-30),0)) %>% 
  mutate(relapse2=ifelse(x>=20,relapse+0.004*sin((x-19.6)/7),0)) %>% 
  mutate(`Base model`=relapse-(0.02/(1+exp(-1*(x-20))))) %>% 
  mutate(`Similar behaviour`=0.9*(relapse-(0.02/(1+exp(-1*(x-20)))))) %>% 
  mutate(`Different behaviour`=((relapse2-(0.02/(1+exp(-1*(x-20))))))) %>% 
  gather(., type, y, `Base model`:`Different behaviour`) %>%
  ggplot()+
  geom_line(aes(x=x, y=y, color=type, linetype=type))+
  scale_y_continuous(limits = c(-0.03,0), labels = scales::percent)+
  ylab("Modeled reduction in outcome")+xlab("Modelled years")+
  guides(colour = guide_legend("Legend", ncol = 2),
         linetype = guide_legend("Legend", ncol = 2))+
  scale_linetype_manual(values=c(2,1,1))+
  scale_color_manual(values=c("black", "red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
data.frame(x=seq(0,50, 0.5)) %>% 
  mutate(relapse=ifelse(x>=30,0.00003*(x-30),0)) %>% 
  mutate(relapse2=ifelse(x>=20,relapse+0.004*sin((x-19.6)/7),0)) %>% 
  mutate(`Base model`=relapse-(0.02/(1+exp(-1*(x-20))))) %>% 
  mutate(`Similar behaviour`=0.9*(relapse-(0.02/(1+exp(-1*(x-20)))))) %>% 
  mutate(`Different behaviour`=((relapse2-(0.02/(1+exp(-1*(x-20))))))) %>% 
  mutate(delta.x=x-lag(x), delta.y1=`Base model`-lag(`Base model`),
         delta.y2=`Similar behaviour`-lag(`Similar behaviour`),delta.y3=`Different behaviour`-lag(`Different behaviour`)) %>% 
  mutate(`Derivative Base model`=delta.y1/delta.x,
         `Derivative Similar behaviour`=delta.y2/delta.x, 
         `Derivative Different behaviour`=delta.y3/delta.x) %>% 
  select(x, `Derivative Base model`:`Derivative Different behaviour`) %>% 
  gather(., type, y, `Derivative Base model`:`Derivative Different behaviour`) %>% 
  filter(!is.na(y)) %>% 
  ggplot()+
  geom_line(aes(x=x, y=y, color=type, linetype=type))+
  # scale_y_continuous(limits = c(0,1), labels = scales::percent)+
  ylab("First derivative")+xlab("Modelled years")+
 guides(colour = guide_legend("Legend", ncol = 2),
         linetype = guide_legend("Legend", ncol = 2))+
  scale_linetype_manual(values=c(2,1,1))+
  scale_color_manual(values=c("black", "red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
  data.frame(x=seq(0,50, 0.5)) %>% 
  mutate(relapse=ifelse(x>=30,0.00003*(x-30),0)) %>% 
  mutate(relapse2=ifelse(x>=20,relapse+0.004*sin((x-19.6)/7),0)) %>% 
  mutate(`Base model`=relapse-(0.02/(1+exp(-1*(x-20))))) %>% 
  mutate(`Similar behaviour`=0.9*(relapse-(0.02/(1+exp(-1*(x-20)))))) %>% 
  mutate(`Different behaviour`=((relapse2-(0.02/(1+exp(-1*(x-20)))))))%>% 
  mutate(`Cummulative difference (Similar-Base)`=`Similar behaviour`-`Base model`,
         `Cummulative difference (Different-Base)`=`Different behaviour`-`Base model`) %>% 
  select(x, `Cummulative difference (Similar-Base)`,  `Cummulative difference (Different-Base)`) %>% 
  gather(., type, y, `Cummulative difference (Similar-Base)`:`Cummulative difference (Different-Base)`) %>% 
  group_by(type) %>% mutate(cum.y=cumsum(abs(y))) %>% 
  ggplot()+
  geom_line(aes(x=x, y=cum.y, color=type, linetype=type))+
  geom_hline(aes(yintercept=0), color="black", linetype="dashed")+
  # scale_y_continuous(labels = scales::percent)+
  ylab("Cummulative difference \n in outcome")+xlab("Modelled years")+
  guides(colour = guide_legend("Legend", ncol = 1),
         linetype = guide_legend("Legend", ncol = 1))+
  scale_linetype_manual(values=c(1,1))+
  scale_color_manual(values=c("red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
  data.frame(x=seq(0,50, 0.5)) %>% 
  mutate(relapse=ifelse(x>=30,0.00003*(x-30),0)) %>% 
  mutate(relapse2=ifelse(x>=20,relapse+0.004*sin((x-19.6)/7),0)) %>% 
  mutate(`Base model`=relapse-(0.02/(1+exp(-1*(x-20))))) %>% 
  mutate(`Similar behaviour`=0.9*(relapse-(0.02/(1+exp(-1*(x-20)))))) %>% 
  mutate(`Different behaviour`=((relapse2-(0.02/(1+exp(-1*(x-20)))))))%>% 
  mutate(delta.x=x-lag(x), delta.y1=`Base model`-lag(`Base model`),
         delta.y2=`Similar behaviour`-lag(`Similar behaviour`),delta.y3=`Different behaviour`-lag(`Different behaviour`)) %>% 
  mutate(`Derivative Base model`=delta.y1/delta.x,
         `Derivative Similar behaviour`=delta.y2/delta.x, 
         `Derivative Different behaviour`=delta.y3/delta.x) %>% 
   mutate(`Cummulative difference (Similar-Base)`=`Derivative Similar behaviour`-`Derivative Base model`,
         `Cummulative difference (Different-Base)`=`Derivative Different behaviour`-`Derivative Base model`) %>% 
  select(x, `Cummulative difference (Similar-Base)`,  `Cummulative difference (Different-Base)`) %>% 
  gather(., type, y, `Cummulative difference (Similar-Base)`:`Cummulative difference (Different-Base)`) %>% 
  filter(!is.na(y)) %>% 
  group_by(type) %>% mutate(cum.y=cumsum(abs(y))) %>% 
  ggplot()+
  geom_line(aes(x=x, y=cum.y, color=type, linetype=type))+
   geom_hline(aes(yintercept=0), color="black", linetype="dashed")+
  # scale_y_continuous(limits = c(0,1), labels = scales::percent)+
 ylab("Cummulative difference \n in First derivative")+xlab("Modelled years")+
  guides(colour = guide_legend("Legend", ncol = 1),
         linetype = guide_legend("Legend", ncol = 1))+
  scale_linetype_manual(values=c(1,1))+
  scale_color_manual(values=c("red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
  plot_layout(ncol=2, nrow = 2)+
    plot_annotation(tag_levels = 'A')
```

## How to interpret the results

Panel A in the below plot shows the summary plot for the energy density of sugar, where the outcome measures the average cumulative difference in the first derivative between policy results from the five main interventions considered in the analysis. The results suggest that energy density for sugar has a greater impact on the policy behaviour for sugar-sweetened beverage tax (SSB) and sports voucher intervention (SVI). The changes in the initial assumption are most impactful in the age groups that each policy is targeting.

Panel B shows the reduction in obesity over time for each sensitivity analysis, with the initial assumption shown in the dotted line. Panel C plots the first derivative of panel B, and panel D shows the cumulative difference between the mode run testing the input and initial assumptions. A higher cumulative difference in first derivatives is associated with model runs with greater model behaviour differences.


```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*12*2.2}
p.tmp1<-df_summary %>% 
  filter(focus.title=="SUGAR Kj per gram" ) %>%
  filter(`Gender outcome`=='Male') %>%
  filter(age.groups.output!="Age 45 49") %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  # facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  # scale_alpha_manual(values=c(0.3,0.3,1), )+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"), alpha = "none")+
  ggtitle("Summary plot: Energy density - Sugar",subtitle = "Male outcomes")

# p.tmp2<-lsa.bmi.df.time.series.diff.derv %>% 
#   rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
#          "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
#   filter(focus.title=="VIGOROUS PA METs" ) %>%
#   # filter(`Gender input`=='Male') %>%
#   filter(`Gender outcome`=='Male') %>%
#   filter(`BMI outcome`=="With obesity") %>%
#   # filter(`BMI input`=="Overweight" ) %>%
#   # filter(`Age input`=="Age 6 8") %>%
#   filter(`Age output`!="Age 45 49") %>%
#   ggplot()+
#   geom_smooth(aes(x=input.value, y=`cum_sum_diff.der_value`), se=F, linewidth=0.5, color=hue_pal()(3)[3], span=0.25)+
#   # geom_vline(aes(xintercept=0, color="Initial assumption"), linetype="dashed", alpha=0.3)+
#   facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
#   scale_colour_manual(values = c("black"))+
#   guides(colour = guide_legend(" "))+
#   # scale_y_continuous(labels = scales::percent, breaks = c(seq(0.05,0.6, 0.15)))+
#   # scale_x_continuous(labels = scales::label_number(suffix = "", scale =1))+
#   ylab("Prevalence of obesity (%) at 2057")+
#   xlab("Percentage of initial assumed Body Weight (kg) for overweight males aged 6 to 8")+
#   theme_bw() +theme(legend.position = "bottom")

p.tmp2<-combined.sugar.int.df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  # filter(focus.title=="VIGOROUS PA METs" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  filter(as.numeric(`Age output`)<=6) %>% 
  # filter(scenario=="SSB") %>% 
  # filter(`Age output`!="Age 45 49") %>%
  # rename("Input value"="input.value") %>% 
  ggplot()+
  geom_line(aes(x=year, y=diff, group=interaction(scenario,input.value), color=input.value), alpha=1)+
  geom_line(aes(x=year, y=diff.det, group=interaction(scenario,input.value)), linetype="dashed", color="black")+
  facet_grid(rows=vars(`Age output`), cols=vars(scenario))+
  theme_bw()+
  ylab("Difference in the Prevalence of obesity (%)")+
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
  theme(legend.position="bottom")+
  ggtitle("Reduction in Outcome from policy")
  
p.tmp3<-combined.sugar.int.df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  # filter(focus.title=="VIGOROUS PA METs" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  filter(as.numeric(`Age output`)<=6) %>% 
  # filter(scenario=="SSB") %>% 
  # filter(`Age output`!="Age 45 49") %>%
  # rename("Input value"="input.value") %>% 
  ggplot()+
  geom_line(aes(x=year, y=diff.der, group=interaction(run,input.value), color=input.value), alpha=1)+
  geom_line(aes(x=year, y=diff.det.der, group=interaction(scenario,input.value)), linetype="dashed", color="black")+
  facet_grid(rows=vars(`Age output`), cols=vars(scenario))+
  theme_bw()+
  ylab("First derivative of difference (%)")+
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
  theme(legend.position="bottom")+
  ggtitle("Reduction in Outcome from policy: First derivative")


p.tmp4<-combined.sugar.int.df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  # filter(focus.title=="VIGOROUS PA METs" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  filter(as.numeric(`Age output`)<=6) %>% 
  # filter(scenario=="SSB") %>% 
  # filter(`Age output`!="Age 45 49") %>%
  # rename("Input value"="input.value") %>% 
  ggplot()+
  geom_line(aes(x=year, y=cum_sum_diff.der_value, group=interaction(run,input.value), color=input.value), alpha=1)+
  stat_summary(aes(x=year, y=cum_sum_diff.der_value), color="red", fun.y=mean,geom="line")+
  # geom_line(aes(x=year, y=value.base.model, group=run), linetype="dashed", color="black")+
  facet_grid(rows=vars(`Age output`), cols=vars(scenario))+
  theme_bw()+
  ylab("Cumulative difference in derivative")+
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
  theme(legend.position="bottom")+
  ggtitle("Cumulative difference: First derivative")



layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
CCCCCCC
CCCCCCC
DDDDDDD
DDDDDDD
'
wrap_plots(A = p.tmp1, B = p.tmp2, C=p.tmp3, D=p.tmp4, design = layout)+
  plot_annotation(tag_levels = 'A')+
# plot_annotation(title = 'Explaination of plots',
#                theme = theme(plot.title = element_text(size = 16, face = c("bold")))) &
theme(legend.position = "bottom")


```


# Results 
Scenarios behavior most impacted by

## Early Prevention of Obesity in Children ranking
```{r, echo=F, message=F, error=F, warning=F}

# + Intervention scale up factor: the assumed fidelity of an the published effect from a control trial as the protocol is scaled up to a national health program.
# + Exposure variables: while each policy has a variety of assumptions that describe exposure, the modelled health benefit from the policies are impacted by exposure
# + Intervention effects: The published effects health effects directly change the policy behavior
# + Relapse: Relapse is th

lsa_int_epoch_df_summary %>%
  group_by(focus.title) %>%
  summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
  ungroup() %>% 
  arrange(-mean_cum_sum_diff.der_value) %>%
    mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                                grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                                grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                                grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                                grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
         grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
  mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
  select(focus.title, mean_cum_sum_diff.der_value) %>%
  rename("Label"="focus.title", "Average cumulative difference in derivatives"="mean_cum_sum_diff.der_value") %>%
  knitr::kable(.) %>%
  # kableExtra::add_header_above(c(" " = 1,"Average cummulative difference \n first derivative" = 5)) %>%
  kableExtra::footnote(., "Ranked variables")
```


## Childcare setting intervention variable ranking
```{r, echo=F, message=F, error=F, warning=F}
lsa_int_cci_df_summary %>%
  group_by(focus.title) %>%
  summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
  ungroup() %>% 
  arrange(-mean_cum_sum_diff.der_value) %>%
      mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                                grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                                grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                                grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                                grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
         grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
  mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
  select(focus.title, mean_cum_sum_diff.der_value) %>%
  rename("Label"="focus.title", "Average cumulative difference in derivatives"="mean_cum_sum_diff.der_value") %>%
  knitr::kable(.) %>%
  # kableExtra::add_header_above(c(" " = 1,"Average cummulative difference \n first derivative" = 5)) %>%
  kableExtra::footnote(., "Ranked variables")
```

## School-based settings interventions ranking
```{r, echo=F, message=F, error=F, warning=F}
lsa_int_si_df_summary %>%
  group_by(focus.title) %>%
  summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
  ungroup() %>% 
  arrange(-mean_cum_sum_diff.der_value) %>%
      mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                                grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                                grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                                grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                                grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
         grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
  mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
  select(focus.title, mean_cum_sum_diff.der_value) %>%
  rename("Label"="focus.title", "Average cumulative difference in derivatives"="mean_cum_sum_diff.der_value") %>%
  knitr::kable(.) %>%
  # kableExtra::add_header_above(c(" " = 1,"Average cummulative difference \n first derivative" = 5)) %>%
  kableExtra::footnote(., "Ranked variables")
```

## Sports voucher interventions ranking
```{r, echo=F, message=F, error=F, warning=F}
lsa_int_svi_df_summary %>%
  group_by(focus.title) %>%
  summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
  ungroup() %>% 
  arrange(-mean_cum_sum_diff.der_value) %>%
      mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                                grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                                grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                                grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                                grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
         grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
  mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
  select(focus.title, mean_cum_sum_diff.der_value) %>%
  rename("Label"="focus.title", "Average cumulative difference in derivatives"="mean_cum_sum_diff.der_value") %>%
  knitr::kable(.) %>%
  # kableExtra::add_header_above(c(" " = 1,"Average cummulative difference \n first derivative" = 5)) %>%
  kableExtra::footnote(., "Ranked variables")
```

## Sugar-Sweetened Beverge Tax % ranking
```{r, echo=F, message=F, error=F, warning=F}
lsa_int_ssb_df_summary %>%
  group_by(focus.title) %>%
  summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
  ungroup() %>% 
  arrange(-mean_cum_sum_diff.der_value) %>%
      mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                                grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                                grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                                grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                                grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
         grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
  mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
  select(focus.title, mean_cum_sum_diff.der_value) %>%
  rename("Label"="focus.title", "Average cumulative difference in derivatives"="mean_cum_sum_diff.der_value") %>%
  knitr::kable(.) %>%
  # kableExtra::add_header_above(c(" " = 1,"Average cummulative difference \n first derivative" = 5)) %>%
  kableExtra::footnote(., "Ranked variables")
```

## Overall Ranking of base model sensitivity
```{r, echo=F, message=F, error=F, warning=F}
df_summary %>%
  group_by(focus.title, scenario) %>%
  summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
  arrange(-mean_cum_sum_diff.der_value) %>%
  select(focus.title, scenario,  mean_cum_sum_diff.der_value) %>%
  spread(., scenario, mean_cum_sum_diff.der_value) %>%
  mutate(total=SSB+EPOCH+CCI+SI+SVI) %>%
  arrange(-total) %>% select(-total) %>%
  mutate(EPOCH=sprintf("%0.3f",mean(EPOCH)),
         CCI=sprintf("%0.3f",mean(CCI)),
         SI=sprintf("%0.3f",mean(SI)),
         SVI=sprintf("%0.3f",mean(SVI)),
         SSB=sprintf("%0.3f",mean(SSB))) %>%
  rename("Label"="focus.title") %>% 
  knitr::kable(.) %>%
  kableExtra::add_header_above(c(" " = 1,"Average cummulative difference \n first derivative" = 5)) %>%
  kableExtra::footnote(., "Ranked variables")
#   
```

# Early Prevention of Obesity in Children
## Early Prevention of Obesity in Children Scale up of intervention effects

```{r EPOCH Scale up der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
 lsa_int_epoch_df_summary %>% 
  rename("Gender output"="gender.output") %>% 
  filter(focus=="EPOCH Scale up factor") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender output`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("BMI Outcome"))+
  ggtitle("Assumed Early Prevention of Obesity in Children Scale up factor")

```


## Early Prevention of Obesity in Children: RCT Intervention effect
```{r RCT Effects, echo=F, message=F, error=F, warning=F, fig.height=1*3*3.5, fig.width=1*2*3.5}
lsa_int_epoch_df_summary %>% 
  filter(focus=="Effect BF OR") %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Assumed Intervention effect - breastfeeding")+
  
  lsa_int_epoch_df_summary %>% 
  filter(focus=="Effect TV OR") %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Assumed Intervention effect - Screen time")+
  
  lsa_int_epoch_df_summary %>% 
  filter(focus=="\"Effect Non-core OR\"") %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Assumed Intervention effect - Non-core food consumption")+
  
  plot_layout(ncol = 1, nrow=3, guides = "collect")&
  # plot_annotation(title = 'Intervention effect',
  #                  theme = theme(plot.title = element_text(size = 16, hjust = 0.5,  face = c("bold")))) & 
  theme(legend.position = "bottom")
  

```


## Percentage of infants exposed to intervention	
```{r Percentage of infants exposed der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_epoch_df_summary %>% 
  filter(focus=="Percentage of infants exposed") %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  # filter(gender.output=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age group")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI Outcome"))+
  ggtitle("Percentage of infants exposed to intervention")
```

## Early Prevention of Obesity in Children: Relapse Rate
```{r EPOCH Relapse Rate, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_epoch_df_summary %>% 
  filter(focus=="Relapse Rate EPOCH") %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age group")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom")+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  guides(colour = guide_legend("BMI"))+
  ggtitle("Early Prevention of Obesity in Children Relapse Rate")
```

# Childcare setting intervention
## Childcare setting intervention Scale up factor
```{r Scale up der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_cci_df_summary %>% 
  filter(focus=="CCI Scale up factor") %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Assumed Childcare setting intervention Scale up factor")

```

## Childcare settings intervention Change in Diet coefficients
```{r Childcare settings intervention Change in Diet der, echo=F, message=F, error=F, warning=F, fig.height=1*2*2, fig.width=1*5*2}
lsa_int_cci_df_summary %>%
  filter(grepl("Childcare settings intervention Change in Diet coefficients", focus)) %>% 
  separate(focus, into=c("first","food.groups"),sep="\\[", remove = F) %>% 
  mutate(`Food groups`=factor(case_when(food.groups=="Discretionary_foods]"~1,
                                       food.groups=="Fruit]"~2,
                                       food.groups=="NonAlcoholic_beverage]"~3,
                                       food.groups=="Sugar_Sweetened beverage]"~4,
                                       food.groups=="Vegetables]"~5),
                             levels=c(1,2,3,4,5),
                             labels=c("Discretionary foods","Fruit",
                                     "Other beverage","Sugar Sweetened beverage", "Vegetables"))) %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(rows=vars(`Gender outcome`),  cols=vars(`Food groups`), scale="free", labeller = label_both, independent = "x")+
  # facet_grid(rows =vars(gender.output), cols=vars(food.groups), scale="free")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 6.5))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Childcare settings intervention Change in Diet")

```

## Childcare settings intervention Change in physical activity coefficients
```{r Childcare settings intervention Change in PA der, echo=F, message=F, error=F, warning=F, fig.height=1*2*2.5, fig.width=1.2*2*2.5}
lsa_int_cci_df_summary %>%
  filter(grepl("Childcare settings intervention Change in PA coefficients", focus)) %>% 
  separate(focus, into=c("first","pa.groups"),sep="\\[", remove = F) %>% 
  mutate(`PA Activity`=factor(case_when(pa.groups=="Light]"~1,
                                       pa.groups=="Screen]"~2),
                             levels=c(1,2),
                             labels=c("Light physical activity","Screen time"))) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(rows=vars(`Gender outcome`),  cols=vars(`PA Activity`), scale="free", labeller = label_both, independent = "x")+
  # facet_grid(rows =vars(gender.output), cols=vars(pa.groups), scale="free")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Childcare settings intervention Change in physical activity")

```

## Percentage of childcare centers participating in intervention
```{r Percentage of childcare centers participating in intervention der, echo=F, message=F, error=F, warning=F, fig.height=1*1*3.5, fig.width=1.2*2*3.5}
lsa_int_cci_df_summary %>% 
  filter(grepl("Percentage of childcare centers participating in intervention", focus)) %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
    facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  # facet_grid(col=vars(gender.output), scale="free")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Percentage of childcare centers participating in intervention")

```

## Definition in food groups
```{r, echo=F, message=F, error=F, warning=F, fig.height=1*2*4.2, fig.width=1*2*4.2}
lsa_int_cci_df_summary %>% 
  filter(grepl("Proportion of Cordial in SSB", focus)) %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Proportion of Cordial in SSB")+
  
  lsa_int_cci_df_summary %>% 
  filter(grepl("Proportion of Packed snacks in Discretionary foods", focus)) %>% 
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Proportion of Packed snacks in Discretionary foods")+
  
  # plot_layout(ncol=2, nrow=1, guides = "collect")&theme(legend.position = "bottom")

  plot_layout(ncol = 1, nrow=2, guides = "collect")+
  plot_annotation(title = 'Assumed composition of intervention foods',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
  
```


# School-based settings interventions
## School-based interventions: Relapse Rate
```{r Relapse Rate SI der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_si_df_summary %>% 
  filter(grepl("Relapse Rate", focus)) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Relapse rate")

```

## Percentage of Schools participating in intervention
```{r SI Percentage of Schools participating in intervention der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_si_df_summary %>% 
  filter(grepl("SI Percentage of Schools participating in intervention", focus)) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Percentage of Schools participating in intervention")

```

## Percentage of total diet consumed at school
```{r SI percentage of total diet consumed at school der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_si_df_summary %>% 
  filter(grepl("SI percentage of total diet consumed at school", focus)) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Percentage of total diet consumed at school")

```

## School-based intervention Scale up factor
```{r SI Scale up factor der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_si_df_summary %>% 
  filter(grepl("SI Scale up factor", focus)) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("School based interventions - Scale up factor")

```

## Phyisical activity at school 
```{r SI change in PA der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
lsa_int_si_df_summary %>% 
  filter(grepl("SI % change in PA", focus)) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Increase in physical activity")

```

## Reduction In student canteen purchases
```{r SI Reduction In student Purchases der, echo=F, message=F, error=F, warning=F, fig.height=1*11*2, fig.width=1.6*2*2}
lsa_int_si_df_summary %>% 
  filter(grepl("SI % Reduction In student Purchases", focus)) %>% 
  separate(focus, into=c("first","food.groups"),sep="\\[", remove = F) %>% 
  mutate(`Food groups`=factor(case_when(food.groups=="Dairy]"~1,
                                      food.groups=="Discretionary_foods]"~2,
                                      food.groups=="Fats]"~3,
                                      food.groups=="Fruit]"~4,
                                      food.groups=="Grains]"~5,
                                      food.groups=="Meat]"~6,
                                      food.groups=="NonAlcoholic_beverage]"~7,
                                      food.groups=="Other]"~8,
                                      food.groups=="Sugar_Sweetened beverage]"~9,
                                      food.groups=="Vegetables]"~10,
                                      food.groups=="Water]"~11),
                             levels=c(seq(1:11)),
                             labels=c("Dairy","Discretionary foods","Fats","Fruit","Grains","Meat",
                                     "Other beverage","Other","Sugar Sweetened beverage", "Vegetables", "Water"))) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),rows=vars(`Food groups`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Reduction In student canteen purchases")

```

## Percentage of children attending School 
```{r SI Percentage of children attending School der, echo=F, message=F, error=F, warning=F, fig.height=1*5*2.5, fig.width=1.4*2*2.5}
lsa_int_si_df_summary %>% 
  filter(grepl("SI Percentage of children attending School", focus)) %>% 
  separate(focus, into=c("first","age.groups.intput"),sep="\\[", remove = F) %>% 
  mutate( `Age input`=factor(case_when(grepl("Age_2,",age.groups.intput)~1,
                                              grepl("Age_3_5",age.groups.intput)~2,
                                              grepl("Age_6_8",age.groups.intput)~3,
                                              grepl("Age_9_11" ,age.groups.intput)~4,
                                              grepl("Age_12_14",age.groups.intput)~5,
                                              grepl("Age_15_17",age.groups.intput)~6,
                                              grepl("Age_18_19",age.groups.intput)~7,
                                              grepl("Age_20_24",age.groups.intput)~8,
                                              grepl("Age_25_29",age.groups.intput)~9,
                                              grepl("Age_30_34",age.groups.intput)~10,
                                              grepl("Age_35_39",age.groups.intput)~11,
                                              grepl("Age_40_44",age.groups.intput)~12,
                                              grepl("Age_45_49",age.groups.intput)~13),
                                    levels=c(seq(1:13)), 
                                    labels=c("Age 2","Age 3 5","Age 6 8","Age 9 11","Age 12 14","Age 15 17",
                                             "Age 18 19","Age 20 24" ,"Age 25 29","Age 30 34","Age 35 39",
                                             "Age 40 44","Age 45 49"))) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),rows=vars(`Age input`),  scale="free", labeller = label_both, independent = "x")+
 # facet_grid(cols =vars(gender.output), rows=vars(age.groups.input), scale="free")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Percentage of children attending School")

```

# Sports voucher interventions
## Sports vouchers Scale up factor
```{r SVI Scale up factor der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
lsa_int_svi_df_summary %>% 
  filter(grepl("SVI Scale up factor", focus)) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("SVI Scale up factor")
```


## Percentage of the population that Registers for vouchers
```{r percentage of population that Registers for vouchers der, echo=F, message=F, error=F, warning=F, fig.height=1*5*2.2, fig.width=1.5*2*2.2} 
lsa_int_svi_df_summary %>% 
  filter(grepl("% of population that Registers for vouchers", focus)) %>% 
  separate(focus, into=c("first","age.groups.intput"),sep="\\[", remove = F) %>% 
  mutate( `Age input`=factor(case_when(grepl("Age_2,",age.groups.intput)~1,
                                              grepl("Age_3_5",age.groups.intput)~2,
                                              grepl("Age_6_8",age.groups.intput)~3,
                                              grepl("Age_9_11" ,age.groups.intput)~4,
                                              grepl("Age_12_14",age.groups.intput)~5,
                                              grepl("Age_15_17",age.groups.intput)~6,
                                              grepl("Age_18_19",age.groups.intput)~7,
                                              grepl("Age_20_24",age.groups.intput)~8,
                                              grepl("Age_25_29",age.groups.intput)~9,
                                              grepl("Age_30_34",age.groups.intput)~10,
                                              grepl("Age_35_39",age.groups.intput)~11,
                                              grepl("Age_40_44",age.groups.intput)~12,
                                              grepl("Age_45_49",age.groups.intput)~13),
                                    levels=c(seq(1:13)), 
                                    labels=c("Age 2","Age 3 5","Age 6 8","Age 9 11","Age 12 14","Age 15 17",
                                             "Age 18 19","Age 20 24" ,"Age 25 29","Age 30 34","Age 35 39",
                                             "Age 40 44","Age 45 49"))) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),rows=vars(`Age input`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("% of population that Registers for vouchers")

```

## Average Number of Hours of organised sports or activities Weekly
```{r Average Number of Hours of organised sports or activities Weekly der, echo=F, message=F, error=F, warning=F, fig.height=1*5*2, fig.width=1.2*6*2}
lsa_int_svi_df_summary %>% 
  filter(grepl("Average Number of Hours of organised sports or activities Weekly", focus)) %>% 
  separate(focus, into=c("first","age.groups.input"),sep="\\[", remove = F) %>% 
  mutate(bmi.input=factor(case_when(grepl("Underweight & Healthy weight", age.groups.input)~1,
                                    grepl("Overweight", age.groups.input)~2,
                                    grepl("Obese", age.groups.input)~3),
                          levels=c(1,2,3),labels=c("Underweight & Healthy weight", "Overweight", "With obesity"))) %>% 
  mutate(`Age input`=factor(case_when(grepl("Age_2,",age.groups.input)~1,
                                              grepl("Age_3_5",age.groups.input)~2,
                                              grepl("Age_6_8",age.groups.input)~3,
                                              grepl("Age_9_11" ,age.groups.input)~4,
                                              grepl("Age_12_14",age.groups.input)~5,
                                              grepl("Age_15_17",age.groups.input)~6,
                                              grepl("Age_18_19",age.groups.input)~7,
                                              grepl("Age_20_24",age.groups.input)~8,
                                              grepl("Age_25_29",age.groups.input)~9,
                                              grepl("Age_30_34",age.groups.input)~10,
                                              grepl("Age_35_39",age.groups.input)~11,
                                              grepl("Age_40_44",age.groups.input)~12,
                                              grepl("Age_45_49",age.groups.input)~13),
                                    levels=c(seq(1:13)), 
                                    labels=c("Age 2","Age 3 5","Age 6 8","Age 9 11","Age 12 14","Age 15 17",
                                             "Age 18 19","Age 20 24" ,"Age 25 29","Age 30 34","Age 35 39",
                                             "Age 40 44","Age 45 49"))) %>% 
      rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`),rows=vars(`Age input`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=12),
                   strip.text = element_text(size = 8))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Average Number of Hours of organised sports or activities Weekly")

```

## Average proportion attributed to vouchers
```{r Average proportion attributed to vouchers der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
lsa_int_svi_df_summary %>% 
  filter(grepl("Average proportion attributed to vouchers", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Average proportion attributed to vouchers")
```

## Average Metabolic Equivalent of Task (MET) for sports Inputs  
```{r Average MET Calculated Inputs der,echo=F, message=F, error=F, warning=F, fig.height=1*2*4, fig.width=1*2*4}
lsa_int_svi_df_summary %>% 
  filter(grepl("Females Average MET Calculated Inputs", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Females sports Average MET Calculated Inputs")+
  
  lsa_int_svi_df_summary %>% 
  filter(grepl("Males Average MET Calculated Inputs", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
 facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Male Average sports MET Calculated Inputs")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect")&theme(legend.position ="bottom")
```

## Sports voucher interventions: Relapse Rate
```{r Relapse Rate SVI der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
lsa_int_svi_df_summary %>% 
  filter(grepl("Relapse Rate", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Relapse Rate")
```

```{r Quality of Life Health Utilities per year Reference,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
## Sports voucher interventions: Quality of Life Health Utilities per year Reference (REAL LIFE EXAMPLE OF ERROR FINDING)
# lsa_int_svi_df_summary %>% 
#   filter(focus=="Quality of Life Health Utilities per year Reference") %>% 
#   # filter(grepl("Quality of Life Health Utilities per year Reference", focus)) %>% 
#     rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3 5", "18 19", "40 44"))+
#   xlab("Age outcomes")+
#   ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    axis.title.y = element_text(size=8),
#                    strip.text = element_text(size = 7))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
#   guides(colour = guide_legend("BMI outcome"))+
#   ggtitle("Quality of Life Health Utilities per year Reference")

# test<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_svi_df_2023-08-16.RDS") %>% 
#              ungroup() %>%
#              filter(focus=="Quality of Life Health Utilities per year Reference")

# p.tmp1<-lsa_int_svi_df_summary %>%
#  filter(focus=="Quality of Life Health Utilities per year Reference") %>%
#   filter(gender.output=="Male") %>% 
#   # filter(grepl("Quality of Life Health Utilities per year Reference", focus)) %>% 
#     rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output, alpha=bmi.output), size=1, show.legend = F)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output, alpha=bmi.output))+
#   # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
#   # facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
#   # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#   #                  labels=c("3-5", "18-19", "40-44"))+
#   scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
#                             "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
#                    labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
#   xlab("Age outcomes")+
#   scale_alpha_manual(values=c(0.3,0.3,1), )+
#     ylab("Mean Cummulative difference \n of the first derivative")+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"), alpha = "none")+
#   ggtitle("Summary plot: Quality of Life Health Utilities per year Reference",subtitle = "Male outcomes")
# 
# 
# p.tmp2<-test %>% 
#   rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
#          "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
#    filter(focus=="Quality of Life Health Utilities per year Reference") %>% 
#   # filter(`Gender input`=='Male') %>%
#   filter(`Gender outcome`=='Male') %>%
#   filter(`BMI outcome`=="With obesity") %>%
#   # filter(`BMI input`=="Overweight" ) %>%
#   # filter(`Age input`=="Age 6 8") %>%
#   filter(`Age output`!="Age 45 49") %>%  
#   ggplot()+
#   geom_line(aes(x=year, y=int.value, group=run, color=input.value), alpha=1)+
#   # geom_line(aes(x=year, y=value.base.model, group=run), linetype="dashed", color="black")+
#   facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
#   theme_bw()+
#   ylab("Prevalence of obesity (%)")+
#   scale_y_continuous(labels = scales::percent)+
#   scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
#   theme(legend.position="bottom")+
#   ggtitle("Outcome")
#   
# p.tmp3<-test %>% 
#   rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
#          "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
#    filter(focus=="Quality of Life Health Utilities per year Reference") %>% 
#   # filter(`Gender input`=='Male') %>%
#   filter(`Gender outcome`=='Male') %>%
#   filter(`BMI outcome`=="With obesity") %>%
#   # filter(`BMI input`=="Overweight" ) %>%
#   # filter(`Age input`=="Age 6 8") %>%
#   filter(`Age output`!="Age 45 49") %>%  
#   ggplot()+
#   geom_line(aes(x=year, y=diff, group=run, color=input.value), alpha=1)+
#   # geom_line(aes(x=year, y=value.der.base.model, group=run), linetype="dashed", color="black")+
#   facet_wrap(vars(`Age output`), ncol = 4, nrow=3, scales = "free")+
#   theme_bw()+
#   ylab("First derivative of obesity (%)")+
#   scale_y_continuous(labels = scales::percent)+
#   scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
#   theme(legend.position="bottom")+
#   ggtitle("First derivative")
#   
# p.tmp4<-test %>% 
#   rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
#          "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
#    filter(focus=="Quality of Life Health Utilities per year Reference") %>% 
#   # filter(`Gender input`=='Male') %>%
#   filter(`Gender outcome`=='Male') %>%
#   filter(`BMI outcome`=="With obesity") %>%
#   # filter(`BMI input`=="Overweight" ) %>%
#   # filter(`Age input`=="Age 6 8") %>%
#   filter(`Age output`!="Age 45 49") %>%  
#   ggplot()+
#   geom_line(aes(x=year, y=cum_diff_int.diff_int.diff.det_der.value, group=run, color=input.value), alpha=1)+
#   stat_summary(aes(x=year, y=cum_diff_int.diff_int.diff.det_der.value), color="red", fun.y=mean,geom="line")+
#   # geom_line(aes(x=year, y=value.der.base.model, group=run), linetype="dashed", color="black")+
#   facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
#   theme_bw()+
#   ylab("Cumulative difference")+
#   # scale_y_continuous(labels = scales::percent)+
#   scale_x_continuous(breaks = c(seq(2000, 2057, 20)))+
#   theme(legend.position="bottom")+
#   ggtitle("Cumulative difference: First derivative")
# 
# 
# 
# layout <- '
# #AAAAA#
# BBBBBBB
# BBBBBBB
# CCCCCCC
# CCCCCCC
# DDDDDDD
# DDDDDDD
# '
# wrap_plots(A = p.tmp1, B = p.tmp2, C=p.tmp3, D=p.tmp4, design = layout)+
# # plot_annotation(title = 'Explaination of plots',
# #                theme = theme(plot.title = element_text(size = 16, face = c("bold")))) &
# theme(legend.position = "bottom")

# test %>% 
#     filter(age.groups.output!="Age 45 49") %>%  
#   # filter(age.groups.output=="Age 12 14" & bmi.output=="With obesity", gender.output=="Male") %>% 
#   filter(bmi.output=="With obesity", gender.output=="Male") %>% 
#   ggplot()+
#   geom_line(aes(x=year, y=int.value.det, color=run))+
#   geom_line(aes(x=year, y=base.model.value.det))+
#   geom_line(aes(x=year, y=int.value))+
#   scale_x_continuous(limits = c(2020, 2040))+
#   facet_wrap(.~age.groups.output, scales = "free")+
#   theme_bw()+theme(legend.position = "bottom")
```

# Sugar-Sweetened Beverge Tax %
## Sugar-Sweetened Beverge Scale up factor
```{r SSB Scale up factor der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
lsa_int_ssb_df_summary %>% 
  filter(grepl("SSB Scale up factor", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
 xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Scale up factor")
```

## Price Elasticity - Cordial
```{r PE Cordial der,echo=F, message=F, error=F, warning=F, fig.height=1*7*2, fig.width=1.5*2*2}
lsa_int_ssb_df_summary %>% 
  filter(grepl("PE Cordial", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  # select(focus) %>% table()
  separate(focus, into=c("first","drink.groups"),sep="\\[", remove = F) %>% 
  mutate(`Drinks`=factor(case_when(drink.groups=="Regular Soft_Drinks]"~1,
                                      drink.groups=="Fruit Drink]"~2,
                                      drink.groups=="Fruit Juice]"~3,
                                      drink.groups=="Low Fat Milk]"~4,
                                      drink.groups=="Cordial]"~5,
                                      drink.groups=="Tea]"~6,
                                      drink.groups=="Water]"~7,
                                      drink.groups=="Diet Soft Drinks]"~8,
                                      drink.groups=="Coffee]"~9),
                             levels=c(seq(1:9)),
                             labels=c("Regular Soft Drinks","Fruit Drink","Fruit Juice",
                                      "Low Fat Milk","Cordial","Tea","Water", "Diet Soft Drinks","Coffee"))) %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), rows = vars(`Drinks`) ,scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Price elasticitiy for cordial")
```


## Price Elasticity -  Fruit Drink
```{r PE Fruit Drink der,echo=F, message=F, error=F, warning=F , fig.height=1*6*2.5, fig.width=1.5*2*2.5}
lsa_int_ssb_df_summary %>% 
  filter(grepl("PE Fruit Drink", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  # select(focus) %>% table()
  separate(focus, into=c("first","drink.groups"),sep="\\[", remove = F) %>% 
  mutate(`Drinks`=factor(case_when(drink.groups=="Regular Soft_Drinks]"~1,
                                      drink.groups=="Fruit Drink]"~2,
                                      drink.groups=="Fruit Juice]"~3,
                                      drink.groups=="Low Fat Milk]"~4,
                                      drink.groups=="Cordial]"~5,
                                      drink.groups=="Tea]"~6,
                                      drink.groups=="Water]"~7,
                                      drink.groups=="Diet Soft Drinks]"~8,
                                      drink.groups=="Coffee]"~9),
                             levels=c(seq(1:9)),
                             labels=c("Regular Soft Drinks","Fruit Drink","Fruit Juice",
                                      "Low Fat Milk","Cordial","Tea","Water", "Diet Soft Drinks","Coffee"))) %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), rows = vars(`Drinks`) ,scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Price elasticitiy for fruit drink")
```

## Price Elasticity -  Soft drink
```{r PE Soft drink der,echo=F, message=F, error=F, warning=F, fig.height=1*3*2.5, fig.width=1.5*2*2.5}
lsa_int_ssb_df_summary %>% 
  filter(grepl("PE Soft drink", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  # select(focus) %>% table()
  separate(focus, into=c("first","drink.groups"),sep="\\[", remove = F) %>% 
  mutate(`Drinks`=factor(case_when(drink.groups=="Regular Soft_Drinks]"~1,
                                      drink.groups=="Fruit Drink]"~2,
                                      drink.groups=="Fruit Juice]"~3,
                                      drink.groups=="Low Fat Milk]"~4,
                                      drink.groups=="Cordial]"~5,
                                      drink.groups=="Tea]"~6,
                                      drink.groups=="Water]"~7,
                                      drink.groups=="Diet Soft Drinks]"~8,
                                      drink.groups=="Coffee]"~9),
                             levels=c(seq(1:9)),
                             labels=c("Regular Soft Drinks","Fruit Drink","Fruit Juice",
                                      "Low Fat Milk","Cordial","Tea","Water", "Diet Soft Drinks","Coffee"))) %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), rows = vars(`Drinks`) ,scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Price elasticitiy for fruit drink")
```

## Sugar-Sweetened Beverge Tax: Relapse Rate
```{r Relapse Rate SSB der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
lsa_int_ssb_df_summary %>% 
  filter(grepl("Relapse Rate", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Sugar-Sweetened Beverge Relapse Rate")
```

## Sugar-Sweetened Beverge Tax %
```{r SB Tax percent der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
lsa_int_ssb_df_summary %>% 
  filter(grepl("SSB Tax", focus)) %>% 
        rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
   xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_text(size=8),
                   strip.text = element_text(size = 7))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  guides(colour = guide_legend("BMI outcome"))+
  ggtitle("Sugar-Sweetened Beverge Tax %")
```



# Interaction between intervention assumptions and base model assumptions
## Body Weight 
**Change in Male Body Weight input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>% 
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Change in Female Body Weight input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


## Height
**Change in Male height input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Change in Female height input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height  (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

## Growth Function kJ/day
**Male growth assumptions**
```{r , echo=F, message=F, error=F, warning=F, fig.width=1.6*5*1.2,fig.height=1*8*1.2}
# plot.df %>%
#     filter(focus.title=="\"Growth Function kJ/day\"") %>% 
#   select(input.value, int.value)


df_summary %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males")+
  
  df_summary %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                                     axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Female")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Growth Function (kJ/day)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Female growth assumptions**
```{r , echo=F, message=F, error=F, warning=F, fig.width=1.6*5*1.2,fig.height=1*8*1.2}
df_summary %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males")+
  
  df_summary %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                                     axis.title.y =element_blank(),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Female")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female Growth Function (kJ/day)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

## Macronutrient energy density
```{r, echo=F, message=F, error=F, warning=F, fig.width=1.6*4*2,fig.height=1*6*2}

left.margin=50

p.tmp1<-df_summary %>%
  filter(focus.title=="\"NON-SUGAR CARBOHYDRATES Kj per gram\"" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")
  
p.tmp2<-df_summary %>%
  filter(focus.title=="FATS Kj per gram" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
    # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")
  
p.tmp3<-df_summary %>%
  filter(focus.title=="PROTEIN Kj per gram" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")
  
p.tmp4<-df_summary %>%
  filter(focus.title=="SUGAR Kj per gram" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")

tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+
  plot_layout(nrow = 4, ncol=1, guides = "collect")+
  plot_annotation(title = 'Energy density (kJ/gram)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))

```

**Explanation of summary results**
[ADD PLOTS]

## Thermic effect of food (TEF)
```{r, echo=F, message=F, error=F, warning=F, fig.width=1.6*4*2,fig.height=1*6*2}

left.margin=50

p.tmp1<-df_summary %>%
  filter(focus.title=="CARBOHYDRATE TEF" ) %>% 
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")
  
p.tmp2<-df_summary %>%
  filter(focus.title=="FATS TEF" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")
  
p.tmp3<-df_summary %>%
  filter(focus.title=="PROTEIN TEF" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")
  


p.tmp4<-df_summary %>%
  filter(focus.title=="SUGAR TEF" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")

tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+
  plot_layout(nrow = 4, ncol=1, guides = "collect")+
  plot_annotation(title = 'Thermic effect of food (TEF)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))

```

**Explanation of summary results**
[ADD PLOTS]

## Adult to Adult Social Transmission
```{r Adult to Adult Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
# Confirm units
# lsa_bmi_df %>%
#     filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
#   select(input.value, `2057`)
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of dietary Behaviors")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Adult Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of physical Behaviors")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Adult Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```

## Adult to Child Social Transmission
```{r Adult to Child Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Child Social Transmission DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of dietary Behaviors")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Child Social Transmission PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of physical Behaviors")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```

## Child to Child Social Transmission
```{r Child to Child Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Child to Child Social Transmission of DIET Behavior" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of dietary Behaviors")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Child to Child Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of physical Behaviors")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Child to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```

## Infant behaviours
```{r Infant Reported behaviours, echo=F, message=F, error=F, warning=F, fig.width=1.6*2*2.5,fig.height=1*6*2.5}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="\"Percentage BF >6mths reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Percentage of mothers breastfeeding to 6 months")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="\"Percentage non-core > 0 reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Percentage of infants consuming non-core foods")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Percentage of infants watching TV more than 1 hr/day")+
  
  plot_layout(nrow = 3, ncol=1, guides = "collect") +
  plot_annotation(title = 'Infant behaviours',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

## Assumed intergenerational relationships
```{r Intergenerational OR effects, echo=F, message=F, error=F, warning=F, fig.width=1.6*2*2.7,fig.height=1*10*2.7}

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Intercept" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Intercept")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="Parents BMI" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of parents BMI on infants weight")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="Breastfeeding >=6mth" ) %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of breastfeeding on infants weight")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="TV >=1" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of TV on infants weight")+
  
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="Non-core >0" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of non-core foods on infants weight")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") +
  plot_annotation(title = 'Logistic regression odds ratio',subtitle = "Odds of overweight or obesity at 2 years",
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom")

```

## Mortality ratios
```{r Mortality ratios, echo=F, message=F, error=F, warning=F, fig.width=1.6*3*2, fig.height=1*4*2}
df_summary %>%
  filter(focus.title=="BMI Hazards Ratios" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`BMI outcome`,`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Hazards Ratios")+
    plot_annotation(title = 'Mortality',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

## The Metabolic Equivalent of Task (MET)
```{r METs, echo=F, message=F, error=F, warning=F, warning=F, fig.width=1.6*4*2, fig.height=1.6*6*2}

left.margin=50

p.tmp1<-df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="INACTIVE METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Inactivity")
  
p.tmp2<-df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="SCREEN TIME METs") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Screen time")
  
p.tmp3<-df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="SLEEP METs") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Sleep")
  
p.tmp4<-df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="LIGHT PA METs") %>%
   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Light physical activity")
  
p.tmp5<-df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="MODERATE PA METs") %>%
   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Moderate physical activity")
  
p.tmp6<-df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="VIGOROUS PA METs") %>%
   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Vigorous physical activity")
  

tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-"";p.tmp5$labels$y<-"";p.tmp6$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+p.tmp5+p.tmp6+
  plot_layout(ncol=1, nrow = 6, guides = "collect") +
  plot_annotation(title = 'Metabolic Equivelence of Task (MET)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))


```

**Explanation of summary results**

## Light physical activity
**Male**
**Female**
```{r Light PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="LIGHT PA"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r Light PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Moderate physical activity
**Male**
**Female**
```{r MODERATE PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="MODERATE PA"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r MODERATE PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


## Vigorous physical activity
**Male**
**Female**
```{r VIGOROUS PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="VIGOROUS PA"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r VIGOROUS PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Screen time
**Male**
**Female**
```{r SCREEN TIME male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="SCREEN TIME"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r SCREEN TIME female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


## Sleep
**Male**
**Female**
```{r SLEEP male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="SLEEP"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r SLEEP female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Fruit Reported Intake
**Male**
**Female**
```{r Fruit male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Fruit"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Fruit female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

##  Vegetables Reported Intake
**Male**
**Female**
```{r Vegetables male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Vegetables"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Vegetables female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

##  Grains Reported Intake
**Male**
**Female**
```{r Grains male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Grains"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Grains female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


##  Dairy Reported Intake
**Male**
**Female**
```{r Dairy male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Dairy"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Dairy female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

##  Meat and Protein Reported
**Male**
**Female**
```{r Meat and Protein male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Meat and Protein"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Meat and Protein female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


##  Discretionary foods Reported
**Male**
**Female**
```{r Discretionary foods male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Discretionary foods"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Discretionary foods female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


##  Fats and Oils Reported
**Male**
**Female**
```{r Fats and Oils male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Fats and Oils"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Fats and Oils female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


##  Sugar based beverage Reported
**Male**
**Female**
```{r Sugar based beverage male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Sugar based beverage"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Sugar based beverage female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


##  Water Reported
**Male**
**Female**
```{r Water male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Water"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Water female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Intercept")+
    
    
  df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Initial fat-mass (%)
**Change in Males fat-mass % assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>% 
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Change in Female fat-mass % assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>% 
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


## Proportion of nutrients within food group Inputs     
**Grains**
```{r Prop of nutrients within food group Grains, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Grains"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```

**Breakdown of summary results**
[ADD PLOTS]

**Vegetables**
```{r Prop of nutrients within food group Vegetables, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Vegetables"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```


**Fruit**
```{r Prop of nutrients within food group Fruit, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Fruit"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Dairy**
```{r Prop of nutrients within food group Dairy, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Dairy"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


**Meat and Protein**
```{r Prop of nutrients within food group Meat, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Meat"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Fats**
```{r Prop of nutrients within food group Fats, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*5*2.7}
tmp.food.group="Fats"

# df_summary %>%
#   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 4, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Discretionary foods**
```{r Prop of nutrients within food group Discretionary_foods, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Discretionary_foods"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',gsub("_", " ",tmp.food.group)),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```


**Sugar-sweetened beverages**
```{r Prop of nutrients within food group Sugar_Sweetened_beverage, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*2.5*2.7}
tmp.food.group="Sugar_Sweetened_beverage"

# df_summary %>%
#   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Carbohydrates")+
#   
#   df_summary %>%
#    filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  # df_summary %>%
  #  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  # filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  # ggplot()+
  # geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  # geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  # xlab("Age outcomes")+
  # ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  # theme_bw()+theme(legend.position = "bottom",
  #                  panel.spacing=unit(0, "mm"),
  #                  strip.text = element_text(size = 7),
  #                  axis.text.x = element_text(size=6),
  #                  axis.text.y = element_text(size=8))+
  # guides(colour = guide_legend("Scenario"))+
  # ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 2, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Non-sugar-sweetened beverages"),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")



```

**Miscellaneous (Other)**
```{r Prop of nutrients within food group Miscellaneous, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Other"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Miscellaneous (Other)"),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")



```

**Non-sugar-sweetened beverages**
```{r Prop of nutrients within food group NonAlcoholic_beverage, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="NonAlcoholic_beverage"

df_summary %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein")+
  
  df_summary %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Non-sugar-sweetened beverages"),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")



```

## Initial BMI Prevalence Inputs
**Change in Male Initial BMI Prevalence**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>% 
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Change in Female Initial BMI Prevalence**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>% 
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  df_summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
df_summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females")+
  
  df_summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab("Average Cumulative difference in intervention effect \n (derivatives)")+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```
